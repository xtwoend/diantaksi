function totalPayment(){var e,t,n,r,i,s,o,u,a,f,l,c,h;e=parseInt($("#setoran_wajib").val());t=parseInt($("#tab_sp").val());n=parseInt($("#pot").val());r=parseInt($("#denda").val());i=parseInt($("#iuran_laka").val());s=parseInt($("#biaya_tc").val());u=parseInt($("#tag_spart").val());a=parseInt($("#tag_ks").val());f=parseInt($("#tag_cicilan_dp").val());l=parseInt($("#tag_dp_spart").val());c=parseInt($("#tag_hut_lama").val());h=parseInt($("#tag_other").val());var p=e+t+r+i+s+u+a+f+l+c+h-n;$("#total").val(p)}function search(e){if(e=="")findAll($("#date").val());else findByName(e)}function findAll(e){console.log("findAll");$.ajax({type:"GET",url:rootURL+"/allfleets/"+e,dataType:"json",success:renderList})}function findByName(e){var t=JSON.stringify({taxi_number:e,date:$("#date").val()});console.log("findByName: "+e);$.ajax({type:"POST",contentType:"application/json",url:rootURL+"/search",dataType:"json",data:t,success:renderList})}function findById(e){var t=$('button[name="dayof"].active').val();var n=$("#total").val();var r=$("#pay_cash").val();var i=r-n;$("#ks").val(i);$("#pay_cash").val("");$("#tag_ks").focus();var s=JSON.stringify({id:e,dayof:t});console.log("findById: "+e);$.ajax({type:"POST",url:rootURL+"/findbyid",dataType:"json",data:s,success:function(e){$("#btnSimpan").show();console.log("findById success: "+e.taxi_number);currentFleet=e;renderDetails(currentFleet)}})}function addsetoran(){console.log("addFinancials");$.ajax({type:"POST",contentType:"application/json",url:rootURL,dataType:"json",data:formToJSON(),success:function(e,t,n){alert("Wine created successfully");$("#btnSimpan").show();$("#wineId").val(e.id)},error:function(e,t,n){alert("addWine error: "+t)}})}function renderList(e){var t=e==null?[]:e.fleet instanceof Array?e.fleet:[e.fleet];$("#armadaList li").remove();$.each(t,function(e,t){$("#armadaList").append('<li><a href="#" data-identity="'+t.id+'">'+t.taxi_number+"</a></li>")})}function renderDetails(e){var t=e.name+" ( "+e.nip+" ) ";var n=e.taxi_number+" ( "+e.police_number+" ) ";$("#infoFleet").text(n);$("#infoDriver").text(t);$("#setoran_wajib").val(parseInt(e.setoran_wajib));$("#tab_sp").val(parseInt(e.tab_sp));$("#pot").val(parseInt(e.pot));$("#denda").val(parseInt(e.denda));$("#iuran_laka").val(parseInt(e.iuran_laka));$("#biaya_tc").val(parseInt(e.biaya_tc));$("#total").val(parseInt(e.total));$("#tag_spart").val(parseInt(e.tag_spart));$("#tag_ks").val(parseInt(e.tag_ks));$("#tag_cicilan_dp").val(parseInt(e.tag_cicilan_dp));$("#tag_dp_spart").val(parseInt(e.tag_dp_spart));$("#tag_hut_lama").val(parseInt(e.tag_hut_lama));$("#tag_other").val(parseInt(e.tag_other));$("#in_time").text(e.in_time)}var currentFleet;$(function(){$("#datepicker").datepicker({format:"yyyy-mm-dd"});$("#normal").button("toggle");$(".money").money_field({width:120});$(".moneypembayaran").money_field({width:290});$("#pay_cash").keyup(function(){var e=$("#total").val();var t=$(this).val();var n=t-e;$("#ks").val(n)});$("input").bind("keypress",function(e){if(e.keyCode==13){var t=$(this).attr("tabindex");var n=$(this).attr("id");var r=0;$.each(currentFleet,function(e,t){if(e===n){r=parseInt(t)}});var i=Math.abs(parseInt($("#"+n).val())||0);var s=i<r?r:i;if(n==="tag_hut_lama"||n==="tag_other"){s=i}$("#"+n).val(s);totalPayment();t++;$("[tabindex="+t+"]").focus();return false}})});findAll($("#date").val());$("#btnSearch").click(function(){search($("#searchKey").val());return false});$("#armadaList a").live("click",function(){findById($(this).data("identity"))});$("#settingSave").click(function(){var e=$('button[name="dayof"].active').val();findAll($("#date").val());return false})